<!DOCTYPE html>
<html>
	<head>
		<title>Emu Archive - HTML based emulator frontend</title>
		<script src="static/jquery-2.1.3.min.js"></script>
		<script src="static/emu_archive.js"></script>
		<script src="static/web_socket.js"></script>
		<link type="text/css" href="static/default.css" media="screen" rel="Stylesheet" />
		<link rel="shortcut icon" href="static/favicon.ico" />
	</head>
	<body>
		<div id="search_header" class="header">
			Search: <input id="search_text" type="text" />
			<br />
			<a href="configure.html">Configure</a>
		</div>

		<div id="error_header" class="header" style="display: none">
			Not connected to server!
			<a href="server.exe">server.exe</a>
		</div>

		<div id="content">		
			<div id="game_dialogs"></div>

			<div id="game_selector" style="overflow: auto;"></div>

			<br style="clear: both"/>

			<div id="output"></div>
		</div>

		<div id="notification_footer" style="display: none;">
		</div>

		<footer>
			<p>Copyright &copy; 2015 Matthew Brennan Jones</p>
			<p><a href="https://github.com/workhorsy/emu_archive">https://github.com/workhorsy/emu_archive</a></p>
		</footer>
	</body>
	<script>
jQuery(function($) {

function on_data(data) {
	if(data['action'] == 'log') {
		console.log('Log: ' + data['value']);
	} else if(data['action'] == 'get_db') {
		console.log("called get_db");
		db = data['value'];
		$('#search_text').on('input propertychange paste', on_search);

		// Show the default search
		on_search();
	} else if(data['action'] == 'long_running_tasks') {
		var notification_footer = $('#notification_footer');
		notification_footer.empty();
		var long_running_tasks = data['value'];
		if(!$.isEmptyObject(long_running_tasks)) {
			$.each(long_running_tasks, function(task_name, percentage) {
				notification_footer.append("<p>" + task_name + " " + percentage.toFixed(2) + "%</p>");
			});
			notification_footer.css("display", "block");
		} else {
			notification_footer.css("display", "none");
		}
	} else {
		console.log('Data: ' + data);
	}
}

if(!("WebSocket" in window)) {
	alert("Your browser does not support web sockets");
} else {
	setup_websocket(on_data, function() {
		message = {
			'action' : 'get_db',
			'value' : ""
		};
		socket_send_data(message);
	});
}

});
	</script>
</html>
