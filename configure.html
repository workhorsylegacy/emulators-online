<!DOCTYPE html>
<html>
	<head>
		<title>Configure - Emu Archive</title>
		<script src="static/jquery-2.1.3.min.js"></script>
		<script src="static/emu_archive.js"></script>
		<script src="static/file_uploader.js"></script>
		<link type="text/css" href="static/default.css" media="screen" rel="Stylesheet" />
	</head>
	<body>
		<h1 style="color: red;">FIXME: Gamepad only works in Firefox!</h1>
		<div id="not_connected" style="display: none">
			Not connected to server!
		</div>

		<div id="genericProgress"></div>

		<div id="config_buttons_demul" style="display: none">
			<h1>Configure Dreamcast Controls</h1>

			<table>
				<tr><td>Up</td><td><input type="button" value="Not Assigned" id="btnUpDemul" /></td></tr>
				<tr><td>Down</td><td><input type="button" value="Not Assigned" id="btnDownDemul" /></td></tr>
				<tr><td>Left</td><td><input type="button" value="Not Assigned" id="btnLeftDemul" /></td></tr>
				<tr><td>Right</td><td><input type="button" value="Not Assigned" id="btnRightDemul" /></td></tr>
				<tr><td>Start</td><td><input type="button" value="Not Assigned" id="btnStartDemul" /></td></tr>
				<tr><td>A</td><td><input type="button" value="Not Assigned" id="btnADemul" /></td></tr>
				<tr><td>B</td><td><input type="button" value="Not Assigned" id="btnBDemul" /></td></tr>
				<tr><td>X</td><td><input type="button" value="Not Assigned" id="btnXDemul" /></td></tr>
				<tr><td>Y</td><td><input type="button" value="Not Assigned" id="btnYDemul" /></td></tr>
				<tr><td>L Trigger</td><td><input type="button" value="Not Assigned" id="btnLTriggerDemul" /></td></tr>
				<tr><td>R Trigger</td><td><input type="button" value="Not Assigned" id="btnRTriggerDemul" /></td></tr>
				<tr><td>Left Stick Up</td><td><input type="button" value="Not Assigned" id="btnLeftStickUpDemul" /></td></tr>
				<tr><td>Left Stick Down</td><td><input type="button" value="Not Assigned" id="btnLeftStickDownDemul" /></td></tr>
				<tr><td>Left Stick Left</td><td><input type="button" value="Not Assigned" id="btnLeftStickLeftDemul" /></td></tr>
				<tr><td>Left Stick Right</td><td><input type="button" value="Not Assigned" id="btnLeftStickRightDemul" /></td></tr>
				<tr><td>Right Stick Up</td><td><input type="button" value="Not Assigned" id="btnRightStickUpDemul" /></td></tr>
				<tr><td>Right Stick Down</td><td><input type="button" value="Not Assigned" id="btnRightStickDownDemul" /></td></tr>
				<tr><td>Right Stick Left</td><td><input type="button" value="Not Assigned" id="btnRightStickLeftDemul" /></td></tr>
				<tr><td>Right Stick Right</td><td><input type="button" value="Not Assigned" id="btnRightStickRightDemul" /></td></tr>
			</table>

			<input type="button" value="Done" id="btn_done_button_config_demul" />
		</div>

		<div id="config_buttons_dolphin" style="display: none">
			<h1>Configure GameCube Controls</h1>

			<table>
				<tr><td>Up</td><td><input type="button" value="Not Assigned" id="btnUpDolphin" /></td></tr>
				<tr><td>Down</td><td><input type="button" value="Not Assigned" id="btnDownDolphin" /></td></tr>
				<tr><td>Left</td><td><input type="button" value="Not Assigned" id="btnLeftDolphin" /></td></tr>
				<tr><td>Right</td><td><input type="button" value="Not Assigned" id="btnRightDolphin" /></td></tr>
				<tr><td>Start</td><td><input type="button" value="Not Assigned" id="btnStartDolphin" /></td></tr>
				<tr><td>A</td><td><input type="button" value="Not Assigned" id="btnADolphin" /></td></tr>
				<tr><td>B</td><td><input type="button" value="Not Assigned" id="btnBDolphin" /></td></tr>
				<tr><td>X</td><td><input type="button" value="Not Assigned" id="btnXDolphin" /></td></tr>
				<tr><td>Y</td><td><input type="button" value="Not Assigned" id="btnYDolphin" /></td></tr>
				<tr><td>Z</td><td><input type="button" value="Not Assigned" id="btnZDolphin" /></td></tr>
				<tr><td>L Trigger</td><td><input type="button" value="Not Assigned" id="btnLTriggerDolphin" /></td></tr>
				<tr><td>R Trigger</td><td><input type="button" value="Not Assigned" id="btnRTriggerDolphin" /></td></tr>
				<tr><td>L Shoulder</td><td><input type="button" value="Not Assigned" id="btnLShoulderDolphin" /></td></tr>
				<tr><td>R Shoulder</td><td><input type="button" value="Not Assigned" id="btnRShoulderDolphin" /></td></tr>
				<tr><td>Left Stick Click</td><td><input type="button" value="Not Assigned" id="btnLeftStickClickDolphin" /></td></tr>
				<tr><td>Right Stick Click</td><td><input type="button" value="Not Assigned" id="btnRightStickClickDolphin" /></td></tr>
				<tr><td>Left Stick Up</td><td><input type="button" value="Not Assigned" id="btnLeftStickUpDolphin" /></td></tr>
				<tr><td>Left Stick Down</td><td><input type="button" value="Not Assigned" id="btnLeftStickDownDolphin" /></td></tr>
				<tr><td>Left Stick Left</td><td><input type="button" value="Not Assigned" id="btnLeftStickLeftDolphin" /></td></tr>
				<tr><td>Left Stick Right</td><td><input type="button" value="Not Assigned" id="btnLeftStickRightDolphin" /></td></tr>
				<tr><td>Right Stick Up</td><td><input type="button" value="Not Assigned" id="btnRightStickUpDolphin" /></td></tr>
				<tr><td>Right Stick Down</td><td><input type="button" value="Not Assigned" id="btnRightStickDownDolphin" /></td></tr>
				<tr><td>Right Stick Left</td><td><input type="button" value="Not Assigned" id="btnRightStickLeftDolphin" /></td></tr>
				<tr><td>Right Stick Right</td><td><input type="button" value="Not Assigned" id="btnRightStickRightDolphin" /></td></tr>
			</table>

			<input type="button" value="Done" id="btn_done_button_config_dolphin" />
		</div>

		<div id="config_programs">
			<h1>Install and Configure Programs</h1>
			
			<table id="installTable" class="configTable">
				<tr>
					<th>Program Name</th>
					<th>Description</th>
					<th>Status</th>
					<th>Controls</th>
					<th>BIOS</th>
				</tr>
				<tr>
					<td>7-ZIP</td>
					<td>
						Allows uncompressing of zip, rar, and 7z files.
					</td>
					<td><input id="btn_install_7zip" type="button" value="Loading ..." disabled /></td>
					</td></td>
				</tr>
				<tr>
					<td>Virtual Clone Drive</td>
					<td>
						Allows mounting of disk images (iso, bin, img, cdi, et cetera). Required for the SSF Sega Saturn emulator.
					</td>
					<td><input id="btn_install_vcd" type="button" value="Loading ..." disabled /></td>
					</td></td>
				</tr>
				<tr>
					<td>NullDC</td>
					<td>
					A Sega Dreamcast Emulator.
					</td>
					<td><input id="btn_install_nulldc" type="button" value="Loading ..." disabled /></td>
				</tr>
				<tr>
					<td>Demul</td>
					<td>
					A Sega Dreamcast emulator.
					</td>
					<td><input id="btn_install_demul" type="button" value="Loading ..." disabled /></td>
					<td><input id="btn_controls_demul" type="button" value="Buttons" disabled /></td>
					<td>
						<nobr><input type="file" id="btn_bios_demul_dc" name="btn_bios_demul_dc" disabled>Dreamcast BIOS (dc.zip)</input></nobr>
						<nobr><input type="file" id="btn_bios_demul_aw" name="btn_bios_demul_aw" disabled>Atomiswave BIOS (awbios.zip)</input></nobr>
						<nobr><input type="file" id="btn_bios_demul_naomi" name="btn_bios_demul_naomi" disabled>Naomi BIOS (naomi.zip)</input></nobr>
						<nobr><input type="file" id="btn_bios_demul_naomi2" name="btn_bios_demul_naomi2" disabled>Naomi 2 BIOS (naomi2.zip)</input></nobr>
					</td>
				</tr>
				<tr>
					<td>SSF</td>
					<td>
					A Sega Saturn emulator. Requires games to be mounted in a tool such as Virtual Clone Drive.
					</td>
					<td><input id="btn_install_ssf" type="button" value="Loading ..." disabled /></td>
				</tr>
				<tr>
					<td>Dolphin</td>
					<td>
					A Nintendo GameCube and Wii emulator.
					</td>
					<td><input id="btn_install_dolphin" type="button" value="Loading ..." disabled /></td>
					<td><input id="btn_controls_dolphin" type="button" value="Buttons" disabled /></td>
				</tr>
				<tr>
					<td>PCSX-Reloaded</td>
					<td>
					A Sony Playstation emulator.
					</td>
					<td><input id="btn_install_pcsxr" type="button" value="Loading ..." disabled /></td>
				</tr>
				<tr>
					<td>PCSX2</td>
					<td>
					A Sony Playstation 2 emulator.
					</td>
					<td>
						<div style="color: red;">FIXME: Can't automate download from build server.</div>
						<input id="btn_install_pcsx2" type="button" value="Loading ..." disabled />
					</td>
				</tr>
				<tr>
					<td>Mupen 64 Plus</td>
					<td>
					A Nintendo 64 emulator. Runs from the command line only.
					</td>
					<td><input id="btn_install_mupen64plus" type="button" value="Loading ..." disabled /></td>
				</tr>
			</table>
		</div>

		<div id="output"></div>

		<footer>
			<p>Copyright &copy; 2015 Matthew Brennan Jones</p>
			<p><a href="https://github.com/workhorsy/emu_archive">https://github.com/workhorsy/emu_archive</a></p>
		</footer>
	</body>
</html>

<script language="JavaScript">

jQuery(function($) {

if(!("WebSocket" in window)) {
	alert("Your browser does not support web sockets");
} else {
	setup_websocket(on_data);
	setup_ui();
}

var gamepad = null;

// Find already connected pads
$.each(navigator.getGamepads(), function(i, pad) {
	if(pad && pad.id) {
		gamepad = pad;
		return false;
	}
});

// Handle connecting and disconnecting pads
function gamepadHandler(e, connecting) {
	if (connecting) {
		gamepad = navigator.getGamepads()[e.gamepad.index];
		console.log("Gamepad connected at index " + gamepad.index + ": " + gamepad.id + ". It has " + gamepad.buttons.length + " buttons and " + gamepad.axes.length + " axes.");
	} else {
		gamepad = null;
	}
}

window.addEventListener("gamepadconnected", function(e) { gamepadHandler(e, true); }, false);
window.addEventListener("gamepaddisconnected", function(e) { gamepadHandler(e, false); }, false);

var is_polling_buttons = false;

function start_polling_buttons(done_cb) {
	is_polling_buttons = true;

	// Check the pressed buttons every 300 ms
	var interval = setInterval(function() {
		var pressed_button = get_pressed_button();
		if(pressed_button != -1) {
			is_polling_buttons = false;
		}

		if(!is_polling_buttons) {
			done_cb(pressed_button);
			clearInterval(interval);
		}
	}, 100);

	// Stop checking after 5 seconds
	setTimeout(function() {
		is_polling_buttons = false;
	}, 5000);
}

function get_pressed_button() {
	if(!gamepad)
		return -1;

	for(var i in gamepad.buttons) {
		var button = gamepad.buttons[i];
		if(button) {
			if(typeof(button) == 'object') {
				if(button.pressed) {
					return 'button_' + i;
				}
			} else if(button) {
				return 'button_' + i;
			}
		}
	}

	for(var i in gamepad.axes) {
		var axis = gamepad.axes[i];
		var sign = axis > 0 ? '+' : '-';
		if(Math.abs(axis) > 0.5) {
			return 'axes_' + i + sign;
		}
	}

	return -1;
}

var button_map_demul = {};
var button_map_dolphin = {};

var is_7zip_installed = false;
var is_vcd_installed = false;
var is_nulldc_installed = false;
var is_demul_installed = false;
var is_ssf_installed = false;
var is_dolphin_installed = false;
var is_pcsxr_installed = false;
var is_pcsx2_installed = false;
var is_mupen_installed = false;

function on_data(data) {
	if(data['action'] == 'log') {
		console.log('Log: ' + data['value']);
	} else if(data['action'] == 'progress') {
		if(data['value'] < 100) {
			$('#config_programs').hide();
			$('#genericProgress').text('Downloading ' + data['name'] + ': ' + data['value'] + '%');
			$('#genericProgress').show();
		} else {
			$('#genericProgress').text('');
			$('#genericProgress').hide();
			$('#config_programs').show();
		}
	} else if(data['action'] == 'is_installed') {
		if (data['name'] == '7-Zip') {
			is_7zip_installed = data['value'];
			if(is_7zip_installed)
				$('#btn_install_7zip').val('Uninstall');
			else
				$('#btn_install_7zip').val('Install');
			$('#btn_install_7zip').prop('disabled', false);
		} else if (data['name'] == 'VirtualCloneDrive') {
			is_vcd_installed = data['value'];
			if(is_vcd_installed)
				$('#btn_install_vcd').val('Uninstall');
			else
				$('#btn_install_vcd').val('Install');
			$('#btn_install_vcd').prop('disabled', false);
		} else if (data['name'] == 'NullDC') {
			is_nulldc_installed = data['value'];
			if(is_nulldc_installed)
				$('#btn_install_nulldc').val('Uninstall');
			else
				$('#btn_install_nulldc').val('Install');
			$('#btn_install_nulldc').prop('disabled', false);
		} else if (data['name'] == 'Demul') {
			is_demul_installed = data['value'];
			if(is_demul_installed) {
				$('#btn_install_demul').val('Uninstall');

				$('#btn_controls_demul').prop('disabled', false);
				$('#btn_bios_demul_dc').prop('disabled', false);
				$('#btn_bios_demul_aw').prop('disabled', false);
				$('#btn_bios_demul_naomi').prop('disabled', false);
				$('#btn_bios_demul_naomi2').prop('disabled', false);
			} else {
				$('#btn_install_demul').val('Install');

				$('#btn_controls_demul').prop('disabled', true);
				$('#btn_bios_demul_dc').prop('disabled', true);
				$('#btn_bios_demul_aw').prop('disabled', true);
				$('#btn_bios_demul_naomi').prop('disabled', true);
				$('#btn_bios_demul_naomi2').prop('disabled', true);
			}
			$('#btn_install_demul').prop('disabled', false);
		} else if (data['name'] == 'SSF') {
			is_ssf_installed = data['value'];
			if(is_ssf_installed)
				$('#btn_install_ssf').val('Uninstall');
			else
				$('#btn_install_ssf').val('Install');
			$('#btn_install_ssf').prop('disabled', false);
		} else if (data['name'] == 'Dolphin') {
			is_dolphin_installed = data['value'];
			if(is_dolphin_installed) {
				$('#btn_install_dolphin').val('Uninstall');

				$('#btn_controls_dolphin').prop('disabled', false);
			} else {
				$('#btn_install_dolphin').val('Install');

				$('#btn_controls_dolphin').prop('disabled', true);
			}
			$('#btn_install_dolphin').prop('disabled', false);
		} else if (data['name'] == 'PCSX-Reloaded') {
			is_pcsxr_installed = data['value'];
			if(is_pcsxr_installed)
				$('#btn_install_pcsxr').val('Uninstall');
			else
				$('#btn_install_pcsxr').val('Install');
			$('#btn_install_pcsxr').prop('disabled', false);
		} else if (data['name'] == 'PCSX2') {
			is_pcsx2_installed = data['value'];
			if(is_pcsx2_installed)
				$('#btn_install_pcsx2').val('Uninstall');
			else
				$('#btn_install_pcsx2').val('Install');
			$('#btn_install_pcsx2').prop('disabled', false);
		} else if (data['name'] == 'Mupen 64 Plus') {
			is_mupen_installed = data['value'];
			if(is_mupen_installed)
				$('#btn_install_mupen64plus').val('Uninstall');
			else
				$('#btn_install_mupen64plus').val('Install');
			$('#btn_install_mupen64plus').prop('disabled', false);
		}
		console.log('is installed: ' + data['name'] + ' ' + data['value'])
	} else if(data['action'] == 'get_button_map') {
		if(data['console'] == 'Dreamcast') {
			button_map_demul = data['value'];

			// Setup each button
			$.each(button_map_demul, function(key, value) {
				// Get button
				var btn = $('#' + key);

				// Set previous value, if there is one
				if(value) {
					btn.val(value);
				}

				// On click poll for a new button
				btn.click(function() {
					btn.val('Press new button ...');
					btn.prop('disabled', true);
					start_polling_buttons(function(button_name) {
						// Save the new button
						if(button_name == -1) {
							btn.val('Not Assigned');
						} else {
							btn.val(button_name);
							button_map_demul[key] = button_name;
						}
						btn.prop('disabled', false);
					});
				});
			});
		} else if(data['console'] == 'GameCube') {
			button_map_dolphin = data['value'];

			// Setup each button
			$.each(button_map_dolphin, function(key, value) {
				// Get button
				var btn = $('#' + key);

				// Set previous value, if there is one
				if(value) {
					btn.val(value);
				}

				// On click poll for a new button
				btn.click(function() {
					btn.val('Press new button ...');
					btn.prop('disabled', true);
					start_polling_buttons(function(button_name) {
						// Save the new button
						if(button_name == -1) {
							btn.val('Not Assigned');
						} else {
							btn.val(button_name);
							button_map_dolphin[key] = button_name;
						}
						btn.prop('disabled', false);
					});
				});
			});
		}
	} else {
		console.log('Data: ' + data);
	}
}

function setup_ui() {
	// FIXME: This should fire after all the websocket stuff is setup
	setTimeout(function() {
		// Figure out if 7-Zip is installed
		var message = {
			'action' : 'is_installed',
			'program' : '7-Zip'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if VCD is installed
		var message = {
			'action' : 'is_installed',
			'program' : 'VirtualCloneDrive'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if NullDC is installed
		message = {
			'action' : 'is_installed',
			'program' : 'NullDC'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if Demul is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Demul'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if SSF is installed
		message = {
			'action' : 'is_installed',
			'program' : 'SSF'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if Dolphin is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Dolphin'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if PCSX-Reloaded is installed
		message = {
			'action' : 'is_installed',
			'program' : 'PCSX-Reloaded'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if PCSX2 is installed
		message = {
			'action' : 'is_installed',
			'program' : 'PCSX2'
		};
		message = JSON.stringify(message);
		socket.send(message);

		// Figure out if Mupen 64 Plus is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Mupen 64 Plus'
		};
		message = JSON.stringify(message);
		socket.send(message);
	}, 3000);

	var btn = $("#btn_install_7zip");
	btn.on('click', function() {
		// Download the exe
		var message = {
			'action' : 'download',
			'file' : '7z920.exe',
			'url' : 'http://www.7-zip.org/a/7z920.exe',
			'dir' : 'downloads',
			'name' : '7-Zip'
		};
		var message = JSON.stringify(message);
		socket.send(message);

		// Run the exe
		var message = {
			'action' : 'install',
			'dir' : 'downloads',
			'file' : '7z920.exe'
		};
		var message = JSON.stringify(message);
		socket.send(message);

		// Figure out if 7-Zip is installed
		var message = {
			'action' : 'is_installed',
			'program' : '7-Zip'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	var btn = $("#btn_install_vcd");
	btn.on('click', function() {
		// Download the exe
		var message = {
			'action' : 'download',
			'file' : 'SetupVirtualCloneDrive.exe',
			'url' : 'http://static.slysoft.com/SetupVirtualCloneDrive.exe',
			'dir' : 'downloads',
			'name' : 'Virtual Clone Drive'
		};
		var message = JSON.stringify(message);
		socket.send(message);

		// Run the exe
		var message = {
			'action' : 'install',
			'dir' : 'downloads',
			'file' : 'SetupVirtualCloneDrive.exe'
		};
		var message = JSON.stringify(message);
		socket.send(message);

		// Figure out if VCD is installed
		var message = {
			'action' : 'is_installed',
			'program' : 'VirtualCloneDrive'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_nulldc");
	btn.on('click', function() {
		if(is_nulldc_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'NullDC'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'nullDC_104_r136.7z',
				'url' : 'https://nulldc.googlecode.com/files/nullDC_104_r136.7z',
				'dir' : 'downloads',
				'name' : 'NullDC'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'nullDC_104_r136.7z'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'NullDC'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_demul");
	btn.on('click', function() {
		if(is_demul_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'Demul'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'demul0582.rar',
				'url' : 'http://demul.emulation64.com/files/demul0582.rar',
				'dir' : 'downloads',
				'name' : 'Demul'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'demul0582.rar'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Demul'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_ssf");
	btn.on('click', function() {
		if(is_ssf_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'SSF'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'SSF_012_beta_R4.zip',
				'url' : 'http://segaretro.org/images/5/5f/SSF_012_beta_R4.zip',
				'dir' : 'downloads',
				'name' : 'SSF'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'SSF_012_beta_R4.zip'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'SSF'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_dolphin");
	btn.on('click', function() {
		if(is_dolphin_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'Dolphin'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'dolphin-master-4.0-5363-x64.7z',
				'url' : 'http://dl.dolphin-emu.org/builds/dolphin-master-4.0-5363-x64.7z',
				'dir' : 'downloads',
				'name' : 'Dolphin'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'dolphin-master-4.0-5363-x64.7z'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Dolphin'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_pcsxr");
	btn.on('click', function() {
		if(is_pcsxr_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'PCSX-Reloaded'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'pcsxr-1.9.93-win32.zip',
				'url' : 'http://download-codeplex.sec.s-msft.com/Download/Release?ProjectName=pcsxr&DownloadId=722143&FileTime=130221145975400000&Build=20959',
				'dir' : 'downloads',
				'name' : 'PCSX Reloaded'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'pcsxr-1.9.93-win32.zip'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'PCSX-Reloaded'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_pcsx2");
	btn.on('click', function() {
		if(is_pcsx2_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'PCSX2'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'pcsx2-v1.3.1-1-gdacadcd-windows-x86.7z',
				'url' : 'http://buildbot.orphis.net/pcsx2/index.php?m=get&rev=v1.3.1-1-gdacadcd&platform=windows-x86',
				'dir' : 'downloads',
				'name' : 'PCSX2'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'pcsx2-v1.3.1-1-gdacadcd-windows-x86.7z'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'PCSX2'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $("#btn_install_mupen64plus");
	btn.on('click', function() {
		if(is_mupen_installed) {
			message = {
				'action' : 'uninstall',
				'program' : 'Mupen64Plus'
			};
			message = JSON.stringify(message);
			socket.send(message);
		} else {
			// Download the compressed program
			var message = {
				'action' : 'download',
				'file' : 'mupen64plus-bundle-win32-2.0.zip',
				'url' : 'https://mupen64plus.googlecode.com/files/mupen64plus-bundle-win32-2.0.zip',
				'dir' : 'downloads',
				'name' : 'Mupen 64 Plus'
			};
			var message = JSON.stringify(message);
			socket.send(message);

			// Uncompress the program
			var message = {
				'action' : 'install',
				'dir' : 'downloads',
				'file' : 'mupen64plus-bundle-win32-2.0.zip'
			};
			var message = JSON.stringify(message);
			socket.send(message);
		}

		// Figure out if it is installed
		message = {
			'action' : 'is_installed',
			'program' : 'Mupen 64 Plus'
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $('#btn_controls_demul');
	btn.on('click', function() {
		$('#config_buttons_demul').show();
		$('#config_programs').hide();

		// Load the button map
		var message = {
			'action' : 'get_button_map',
			'console' : 'Dreamcast',
			'value' : button_map_demul
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $('#btn_controls_dolphin');
	btn.on('click', function() {
		$('#config_buttons_dolphin').show();
		$('#config_programs').hide();

		// Load the button map
		var message = {
			'action' : 'get_button_map',
			'console' : 'GameCube',
			'value' : button_map_dolphin
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $('#btn_done_button_config_demul');
	btn.on('click', function() {
		$('#config_buttons_demul').hide();
		$('#config_programs').show();

		// Save the button map
		var message = {
			'action' : 'set_button_map',
			'console' : 'Dreamcast',
			'value' : button_map_demul
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	btn = $('#btn_done_button_config_dolphin');
	btn.on('click', function() {
		$('#config_buttons_dolphin').hide();
		$('#config_programs').show();

		// Save the button map
		var message = {
			'action' : 'set_button_map',
			'console' : 'GameCube',
			'value' : button_map_dolphin
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	FileUploader('btn_bios_demul_dc', 'genericProgress', function(file_data) {
		var message = {
			'action' : 'set_bios',
			'console' : 'Dreamcast',
			'type' : 'dc.zip',
			'value' : window.btoa(file_data)
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	FileUploader('btn_bios_demul_aw', 'genericProgress', function(file_data) {
		var message = {
			'action' : 'set_bios',
			'console' : 'Dreamcast',
			'type' : 'awbios.zip',
			'value' : window.btoa(file_data)
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	FileUploader('btn_bios_demul_naomi', 'genericProgress', function(file_data) {
		var message = {
			'action' : 'set_bios',
			'console' : 'Dreamcast',
			'type' : 'naomi.zip',
			'value' : window.btoa(file_data)
		};
		message = JSON.stringify(message);
		socket.send(message);
	});

	FileUploader('btn_bios_demul_naomi2', 'genericProgress', function(file_data) {
		var message = {
			'action' : 'set_bios',
			'console' : 'Dreamcast',
			'type' : 'naomi2.zip',
			'value' : window.btoa(file_data)
		};
		message = JSON.stringify(message);
		socket.send(message);
	});
}

});
</script>
